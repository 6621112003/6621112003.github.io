<!doctype html>
<html lang="th" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ô‡πà‡∏≤‡∏≠‡∏£‡πà‡∏≠‡∏¢‡πÉ‡∏Å‡∏•‡πâ‡∏â‡∏±‡∏ô</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
  
  <style>
    /* Custom Styles */
    body { font-family: 'Prompt', sans-serif; }
    .gradient-bg { background: linear-gradient(135deg, #ff6b35 0%, #f7931e 50%, #ffcc02 100%); }
    .card-hover { transition: all 0.3s ease; }
    .card-hover:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(255, 107, 53, 0.2); }
    .glass-effect { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
    .category-btn { transition: all 0.2s ease; }
    .category-btn:hover, .category-btn.active { background: linear-gradient(135deg, #ff6b35, #f7931e); color: white; transform: scale(1.05); }
    .fade-in { animation: fadeIn 0.5s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .toast { animation: slideIn 0.3s ease-out; }
    @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    /* Scrollbar for horizontal categories */
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
 </head>
 <body class="h-full bg-gradient-to-br from-orange-50 via-amber-50 to-yellow-50">
  <div id="app" class="h-full overflow-auto">
   
   <div id="loadingScreen" class="fixed inset-0 gradient-bg flex items-center justify-center z-50">
    <div class="text-center text-white">
     <div class="text-6xl mb-4 animate-bounce">üçú</div>
     <div class="text-2xl font-bold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏£‡πà‡∏≠‡∏¢...</div>
    </div>
   </div>

   <div id="mainContent" class="hidden">
    
    <nav class="glass-effect sticky top-0 z-40 shadow-lg">
     <div class="max-w-7xl mx-auto px-4 py-3">
      <div class="flex items-center justify-between">
       <div class="flex items-center gap-3 cursor-pointer" onclick="showPage('home')">
        <div class="text-4xl">üçú</div>
        <div>
         <h1 class="text-xl font-bold bg-gradient-to-r from-orange-600 to-amber-500 bg-clip-text text-transparent">‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏£‡πà‡∏≠‡∏¢‡πÉ‡∏Å‡∏•‡πâ‡∏â‡∏±‡∏ô</h1>
        </div>
       </div>
       <div class="flex gap-2">
        <button onclick="showPage('home')" class="px-3 py-2 text-gray-600 hover:text-orange-500 font-medium text-sm md:text-base">üè† ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button> 
        <button id="adminBtn" onclick="showPage('login')" class="px-3 py-2 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-full font-medium shadow-md text-sm md:text-base">üîê ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>
       </div>
      </div>
     </div>
    </nav>

    <div id="homePage" class="page">
     <div class="gradient-bg py-12 px-4 text-center text-white rounded-b-[3rem] shadow-xl mb-8">
       <h2 class="text-3xl md:text-5xl font-bold mb-4 drop-shadow-md">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏î‡πá‡∏î ‡πÉ‡∏Å‡∏•‡πâ‡∏ï‡∏±‡∏ß‡∏Ñ‡∏∏‡∏ì üçΩÔ∏è</h2>
       <p class="mb-6 opacity-90">‡∏£‡∏ß‡∏°‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏¢‡∏≠‡∏î‡∏Æ‡∏¥‡∏ï ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÅ‡∏ô‡πà‡∏ô ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡πÇ‡∏ã‡∏ô</p>
       <div class="max-w-2xl mx-auto bg-white rounded-full p-2 flex shadow-2xl">
         <span class="pl-4 py-2 text-2xl">üîç</span>
         <input type="text" id="searchInput" placeholder="‡∏´‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‡∏î‡∏µ..." class="flex-1 px-4 py-2 outline-none text-gray-700 rounded-full text-lg" oninput="filterRestaurants()"> 
       </div>
     </div>

     <div class="max-w-7xl mx-auto px-4 pb-16">
      <div class="mb-6">
       <div class="flex gap-2 overflow-x-auto hide-scrollbar pb-2" id="categoryFilters">
        <button onclick="setCategory('')" class="category-btn active whitespace-nowrap px-4 py-2 bg-white rounded-full shadow-md font-medium text-gray-600" data-category="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button> 
        <button onclick="setCategory('‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß')" class="category-btn whitespace-nowrap px-4 py-2 bg-white rounded-full shadow-md font-medium text-gray-600" data-category="‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß">üçú ‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß</button> 
        <button onclick="setCategory('‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á')" class="category-btn whitespace-nowrap px-4 py-2 bg-white rounded-full shadow-md font-medium text-gray-600" data-category="‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á">üç≥ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á</button> 
        <button onclick="setCategory('‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô')" class="category-btn whitespace-nowrap px-4 py-2 bg-white rounded-full shadow-md font-medium text-gray-600" data-category="‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô">üç£ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô</button>
        <button onclick="setCategory('‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏≠‡∏µ‡∏™‡∏≤‡∏ô')" class="category-btn whitespace-nowrap px-4 py-2 bg-white rounded-full shadow-md font-medium text-gray-600" data-category="‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏≠‡∏µ‡∏™‡∏≤‡∏ô">üå∂Ô∏è ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏≠‡∏µ‡∏™‡∏≤‡∏ô</button>
        <button onclick="setCategory('‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô')" class="category-btn whitespace-nowrap px-4 py-2 bg-white rounded-full shadow-md font-medium text-gray-600" data-category="‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô">üç∞ ‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô</button>
        <button onclick="setCategory('‡∏Å‡∏≤‡πÅ‡∏ü/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°')" class="category-btn whitespace-nowrap px-4 py-2 bg-white rounded-full shadow-md font-medium text-gray-600" data-category="‡∏Å‡∏≤‡πÅ‡∏ü/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°">‚òï ‡∏Å‡∏≤‡πÅ‡∏ü</button>
        <button onclick="setCategory('‡∏ö‡∏∏‡∏ü‡πÄ‡∏ü‡πà‡∏ï‡πå')" class="category-btn whitespace-nowrap px-4 py-2 bg-white rounded-full shadow-md font-medium text-gray-600" data-category="‡∏ö‡∏∏‡∏ü‡πÄ‡∏ü‡πà‡∏ï‡πå">üçñ ‡∏ö‡∏∏‡∏ü‡πÄ‡∏ü‡πà‡∏ï‡πå</button>
       </div>
      </div>
      
      <div class="mb-6 flex justify-end">
       <select id="zoneFilter" onchange="filterRestaurants()" class="w-full md:w-64 px-4 py-2 bg-white rounded-xl shadow border border-gray-100 outline-none focus:ring-2 focus:ring-orange-400"> 
         <option value="">üìç ‡∏ó‡∏∏‡∏Å‡πÄ‡∏Ç‡∏ï‡πÉ‡∏ô‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø</option> 
       </select>
      </div>

      <div id="restaurantGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      
      <div id="emptyState" class="hidden text-center py-16 text-gray-500 bg-white rounded-2xl shadow-sm border border-dashed border-gray-300">
        <div class="text-6xl mb-2">üçΩÔ∏è</div>
        <p class="text-xl">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
      </div>
     </div>
    </div>

    <div id="detailPage" class="page hidden">
     <div class="max-w-5xl mx-auto px-4 py-8 fade-in">
       <button onclick="showPage('home')" class="mb-4 px-4 py-2 bg-white rounded-full shadow text-gray-600 hover:text-orange-500 font-medium transition flex items-center gap-2">
         ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
       </button>
       <div id="restaurantDetailContent" class="bg-white rounded-3xl shadow-2xl overflow-hidden pb-8 min-h-[50vh]">
         </div>
     </div>
    </div>

    <div id="loginPage" class="page hidden">
     <div class="min-h-screen flex items-center justify-center px-4 -mt-20">
      <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md text-center fade-in border-t-4 border-orange-500">
       <div class="text-5xl mb-4">üîê</div>
       <h2 class="text-2xl font-bold mb-4 text-gray-800">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h2>
       <p class="text-gray-400 text-sm mb-6 bg-gray-100 p-2 rounded">User: <b>Admin</b> / Pass: <b>12345678</b></p>
       <input type="text" id="loginUsername" class="w-full mb-3 px-4 py-3 border border-gray-200 rounded-xl outline-none focus:border-orange-500" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
       <input type="password" id="loginPassword" class="w-full mb-6 px-4 py-3 border border-gray-200 rounded-xl outline-none focus:border-orange-500" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
       <button onclick="handleLogin()" class="w-full py-3 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-xl font-bold hover:shadow-lg transform transition active:scale-95">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>
     </div>
    </div>

    <div id="adminPage" class="page hidden">
     <div class="max-w-7xl mx-auto px-4 py-8">
      <div class="bg-white rounded-2xl shadow-lg p-6 mb-6 flex flex-col md:flex-row justify-between items-center gap-4 fade-in">
       <h2 class="text-2xl font-bold text-gray-800">üõ†Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ <span class="text-sm font-normal text-gray-500">(Admin: <span id="adminName" class="text-orange-500 font-bold"></span>)</span></h2>
       <div class="flex gap-2">
         <button onclick="showRestaurantForm()" class="px-6 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-full shadow hover:shadow-lg font-medium transition transform hover:-translate-y-1">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
         <button onclick="handleLogout()" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-full hover:bg-red-500 hover:text-white transition">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
       </div>
      </div>
      <div id="adminRestaurantList" class="space-y-4"></div>
     </div>
    </div>

    <div id="restaurantModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50 p-4 backdrop-blur-sm">
     <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
      <div class="p-6">
       <div class="flex justify-between items-center mb-6 border-b pb-4">
        <h3 id="restaurantFormTitle" class="text-xl font-bold text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h3>
        <button onclick="closeRestaurantForm()" class="text-3xl text-gray-400 hover:text-gray-600">&times;</button>
       </div>
       
       <div class="space-y-4">
        <div>
          <label class="text-sm font-bold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô *</label>
          <input type="text" id="formName" class="w-full px-4 py-2 border rounded-xl focus:ring-2 focus:ring-orange-400 outline-none" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡πÄ‡∏£‡∏∑‡∏≠‡∏£‡∏™‡πÄ‡∏î‡πá‡∏î">
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-bold text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó *</label>
            <select id="formCategory" class="w-full px-4 py-2 border rounded-xl outline-none"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option><option value="‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß">üçú ‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß</option><option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á">üç≥ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á</option><option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô">üç£ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô</option><option value="‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏≠‡∏µ‡∏™‡∏≤‡∏ô">üå∂Ô∏è ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏≠‡∏µ‡∏™‡∏≤‡∏ô</option><option value="‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô">üç∞ ‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô</option><option value="‡∏Å‡∏≤‡πÅ‡∏ü/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°">‚òï ‡∏Å‡∏≤‡πÅ‡∏ü/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</option><option value="‡∏ö‡∏∏‡∏ü‡πÄ‡∏ü‡πà‡∏ï‡πå">üçñ ‡∏ö‡∏∏‡∏ü‡πÄ‡∏ü‡πà‡∏ï‡πå</option></select>
          </div>
          <div>
            <label class="text-sm font-bold text-gray-700">‡πÄ‡∏Ç‡∏ï *</label>
            <select id="formZone" class="w-full px-4 py-2 border rounded-xl outline-none"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ç‡∏ï</option></select>
          </div>
        </div>

        <div>
          <label class="text-sm font-bold text-gray-700">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
          <textarea id="formDescription" rows="3" class="w-full px-4 py-2 border rounded-xl outline-none" placeholder="‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô ‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥..."></textarea>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-bold text-gray-700">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
            <input type="text" id="formAddress" class="w-full px-4 py-2 border rounded-xl outline-none" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á">
          </div>
          <div>
            <label class="text-sm font-bold text-gray-700">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
            <input type="tel" id="formPhone" class="w-full px-4 py-2 border rounded-xl outline-none" placeholder="0xx-xxx-xxxx">
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4 bg-gray-50 p-3 rounded-xl border">
         <div><label class="text-xs text-gray-500">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î</label><input type="time" id="formOpenTime" class="w-full border rounded px-2 py-1"></div>
         <div><label class="text-xs text-gray-500">‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏¥‡∏î</label><input type="time" id="formCloseTime" class="w-full border rounded px-2 py-1"></div>
        </div>
        
        <div class="border-2 border-dashed border-orange-200 rounded-xl p-4 bg-orange-50 text-center">
          <label class="block font-bold mb-2 text-orange-800">üì∑ ‡∏£‡∏π‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏Å (1 ‡∏£‡∏π‡∏õ)</label>
          <div id="coverPreview" class="hidden mb-3 relative h-48 bg-gray-200 rounded-lg overflow-hidden group">
            <img id="coverPreviewImg" class="h-full w-full object-cover"> 
            <button onclick="removeCoverImage()" class="absolute top-2 right-2 bg-red-500 text-white w-8 h-8 rounded-full shadow hover:bg-red-600 transition">√ó</button>
          </div>
          <button onclick="document.getElementById('coverImageInput').click()" class="bg-white border border-orange-300 text-orange-600 px-4 py-2 rounded-lg text-sm font-bold hover:bg-orange-100 transition">üìÅ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏õ‡∏Å</button>
          <input type="file" id="coverImageInput" accept="image/*" onchange="handleCoverUpload(event)" class="hidden">
        </div>

        <div class="border-2 border-dashed border-blue-200 rounded-xl p-4 bg-blue-50">
          <label class="block font-bold mb-2 text-blue-800">üñºÔ∏è ‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡πÉ‡∏™‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢)</label>
          <div id="galleryPreviewGrid" class="grid grid-cols-3 md:grid-cols-5 gap-2 mb-3">
             </div>
          <button onclick="document.getElementById('galleryImageInput').click()" class="bg-white border border-blue-300 text-blue-600 px-4 py-2 rounded-lg text-sm font-bold hover:bg-blue-100 transition w-full">üìÅ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ)</button>
          <input type="file" id="galleryImageInput" accept="image/*" multiple onchange="handleGalleryUpload(event)" class="hidden">
          <p class="text-xs text-blue-400 mt-2 text-center">*‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏¢‡πà‡∏≠‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÉ‡∏™‡πà‡πÑ‡∏î‡πâ 5-10 ‡∏£‡∏π‡∏õ)</p>
        </div>

        <div class="flex gap-4 pt-4 border-t">
         <button onclick="closeRestaurantForm()" class="flex-1 py-3 bg-gray-200 text-gray-700 rounded-xl font-bold hover:bg-gray-300 transition">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
         <button onclick="saveRestaurant()" id="saveRestaurantBtn" class="flex-1 py-3 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-xl font-bold shadow-lg hover:shadow-xl transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
       </div>
      </div>
     </div>
    </div>

    <div id="cropModal" class="fixed inset-0 bg-black bg-opacity-90 hidden items-center justify-center z-[60] p-4">
     <div class="bg-white rounded-2xl w-full max-w-4xl p-6">
      <h3 class="text-lg font-bold mb-4">‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏õ‡∏Å</h3>
      <div class="mb-4 h-[60vh] bg-gray-100 rounded-xl overflow-hidden"><img id="cropImage" style="max-width: 100%;"></div>
      <div class="flex gap-4">
       <button onclick="closeCropModal()" class="flex-1 py-3 bg-gray-200 rounded-xl font-bold">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
       <button onclick="confirmCrop()" class="flex-1 py-3 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-xl font-bold">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ</button>
      </div>
     </div>
    </div>

   </div>
  </div>

  <script>
    // --- 1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (Mock Database) ---
    const INITIAL_DB = {
        restaurants: [
            { 
                __backendId: 'r1', name: '‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡πÄ‡∏£‡∏∑‡∏≠‡∏•‡∏∏‡∏á‡∏î‡∏≥', category: '‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß', zone: '‡∏õ‡∏ó‡∏∏‡∏°‡∏ß‡∏±‡∏ô', 
                description: '‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡πâ‡∏≥‡∏ï‡∏Å‡∏™‡∏π‡∏ï‡∏£‡πÇ‡∏ö‡∏£‡∏≤‡∏ì ‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô‡∏™‡∏∞‡πÉ‡∏à ‡∏ä‡∏≤‡∏°‡∏•‡∏∞ 20 ‡∏ö‡∏≤‡∏ó', 
                address: '‡∏Ç‡πâ‡∏≤‡∏á‡∏ß‡∏±‡∏î‡∏õ‡∏ó‡∏∏‡∏°‡∏ß‡∏ô‡∏≤‡∏£‡∏≤‡∏°', phone: '081-234-5678',
                totalRating: 4.5, ratingCount: 10, openTime: '08:00', closeTime: '16:00',
                gallery: [] // ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ
            },
            {
                __backendId: 'r2', name: 'The Coffee Space', category: '‡∏Å‡∏≤‡πÅ‡∏ü/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°', zone: '‡∏ö‡∏≤‡∏á‡∏£‡∏±‡∏Å',
                description: '‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà‡∏°‡∏¥‡∏ô‡∏¥‡∏°‡∏≠‡∏• ‡∏Å‡∏≤‡πÅ‡∏ü‡∏Ñ‡∏±‡πà‡∏ß‡πÄ‡∏≠‡∏á ‡∏´‡∏≠‡∏°‡∏Å‡∏£‡∏∏‡πà‡∏ô ‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ',
                address: '‡∏ã‡∏≠‡∏¢‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡∏Å‡∏£‡∏∏‡∏á 44', phone: '02-333-4444',
                totalRating: 5.0, ratingCount: 25, openTime: '07:00', closeTime: '18:00',
                gallery: []
            }
        ],
        users: [{ __backendId: 'u1', username: 'Admin', password: '12345678', role: 'admin' }]
    };

    // --- 2. ‡∏£‡∏∞‡∏ö‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á (LocalStorage Service) ---
    class LocalDataService {
        constructor() { this.KEY = 'thai_food_finder_v3'; this.load(); }
        
        load() {
            try {
                const d = localStorage.getItem(this.KEY);
                this.db = d ? JSON.parse(d) : JSON.parse(JSON.stringify(INITIAL_DB));
                // Ensure structure
                if(!this.db.restaurants) this.db.restaurants = [];
                // Migration check
                this.db.restaurants.forEach(r => { if(!r.gallery) r.gallery = []; });
                this.save();
            } catch(e) { console.error('Load Error:', e); this.db = INITIAL_DB; }
        }

        save() { 
            try {
                localStorage.setItem(this.KEY, JSON.stringify(this.db));
                if(this.cb) this.cb(this.getAll());
            } catch(e) { 
                alert('‚ö†Ô∏è ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ï‡πá‡∏°! (Quota Exceeded)\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡πà‡∏≤‡πÜ ‡∏≠‡∏≠‡∏Å‡∏ö‡πâ‡∏≤‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏•‡∏á‡∏Ñ‡∏£‡∏±‡∏ö'); 
            }
        }

        init(cb) { this.cb = cb; setTimeout(() => this.save(), 500); }
        
        getAll() { 
            return [...this.db.restaurants.map(i=>({...i, type:'restaurant'})), ...this.db.users.map(i=>({...i, type:'user'}))]; 
        }
        
        create(item) { 
            item.__backendId = Date.now().toString() + Math.random().toString(36).substr(2,5);
            if(item.type==='restaurant') this.db.restaurants.push(item);
            else if(item.type==='user') this.db.users.push(item);
            this.save(); return Promise.resolve({isOk:true});
        }
        
        update(item) {
            let col = item.type==='restaurant' ? this.db.restaurants : this.db.users;
            const idx = col.findIndex(i=>i.__backendId===item.__backendId);
            if(idx!==-1) { col[idx] = item; this.save(); }
            return Promise.resolve({isOk:true});
        }
        
        delete(item) {
            if(item.type==='restaurant') this.db.restaurants = this.db.restaurants.filter(i=>i.__backendId!==item.__backendId);
            else if(item.type==='user') this.db.users = this.db.users.filter(i=>i.__backendId!==item.__backendId);
            this.save(); return Promise.resolve({isOk:true});
        }
    }
    
    // Init Database
    window.dataSdk = new LocalDataService();

    // --- 3. ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Global ---
    const districts = ['‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£', '‡∏î‡∏∏‡∏™‡∏¥‡∏ï', '‡∏õ‡∏ó‡∏∏‡∏°‡∏ß‡∏±‡∏ô', '‡∏ö‡∏≤‡∏á‡∏£‡∏±‡∏Å', '‡∏ö‡∏≤‡∏á‡πÄ‡∏Ç‡∏ô', '‡∏ö‡∏≤‡∏á‡∏Å‡∏∞‡∏õ‡∏¥', '‡∏à‡∏ï‡∏∏‡∏à‡∏±‡∏Å‡∏£', '‡∏•‡∏≤‡∏î‡∏û‡∏£‡πâ‡∏≤‡∏ß', '‡∏ß‡∏±‡∏í‡∏ô‡∏≤', '‡∏û‡∏£‡∏∞‡πÇ‡∏Ç‡∏ô‡∏á', '‡∏Ñ‡∏•‡∏≠‡∏á‡πÄ‡∏ï‡∏¢', '‡∏û‡∏ç‡∏≤‡πÑ‡∏ó', '‡∏™‡∏≤‡∏ó‡∏£', '‡∏ö‡∏≤‡∏á‡∏ã‡∏∑‡πà‡∏≠', '‡∏ò‡∏ô‡∏ö‡∏∏‡∏£‡∏µ', '‡∏î‡∏¥‡∏ô‡πÅ‡∏î‡∏á', '‡∏´‡πâ‡∏ß‡∏¢‡∏Ç‡∏ß‡∏≤‡∏á', '‡∏™‡∏ß‡∏ô‡∏´‡∏•‡∏ß‡∏á', '‡∏ö‡∏≤‡∏á‡∏ô‡∏≤', '‡∏£‡∏≤‡∏ä‡πÄ‡∏ó‡∏ß‡∏µ', '‡∏™‡∏≤‡∏¢‡πÑ‡∏´‡∏°'];
    let restaurants = [], users = [], currentUser = null, editingItem = null;
    let categoryFilter = '', coverImg = '', galleryImgs = [], cropper = null;

    // --- 4. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (Initialization) ---
    function init() {
        const z = document.getElementById('zoneFilter'), fz = document.getElementById('formZone');
        districts.sort().forEach(d => {
            z.innerHTML += `<option value="${d}">${d}</option>`;
            fz.innerHTML += `<option value="${d}">${d}</option>`;
        });
        
        window.dataSdk.init((data) => {
            restaurants = data.filter(d => d.type === 'restaurant');
            users = data.filter(d => d.type === 'user');
            renderGrid(); // Render Home
            renderAdmin(); // Render Admin List
        });

        // Hide Loading
        setTimeout(() => {
            document.getElementById('loadingScreen').classList.add('fade-out-hidden'); // Custom fade could be added
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('mainContent').classList.remove('hidden');
        }, 1000);
    }

    // --- 5. ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏ó‡∏≤‡∏á (Navigation) ---
    function showPage(p) {
        document.querySelectorAll('.page').forEach(x => x.classList.add('hidden'));
        document.getElementById(p + 'Page').classList.remove('hidden');
        window.scrollTo(0,0);
    }
    
    // --- 6. ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å (Home) ---
    function setCategory(c) {
        categoryFilter = c;
        document.querySelectorAll('.category-btn').forEach(b => b.classList.toggle('active', b.dataset.category === c));
        filterRestaurants();
    }
    
    function filterRestaurants() {
        const s = document.getElementById('searchInput').value.toLowerCase();
        const z = document.getElementById('zoneFilter').value;
        const list = restaurants.filter(r => {
            return (!s || r.name.toLowerCase().includes(s) || (r.description && r.description.toLowerCase().includes(s))) && 
                   (!categoryFilter || r.category === categoryFilter) &&
                   (!z || r.zone === z);
        });
        renderGrid(list);
    }
    
    function renderGrid(list = restaurants) {
        const g = document.getElementById('restaurantGrid'), e = document.getElementById('emptyState');
        if(list.length===0) { g.innerHTML=''; e.classList.remove('hidden'); return; }
        e.classList.add('hidden');
        
        g.innerHTML = list.map(r => `
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover cursor-pointer group border border-gray-100" onclick="viewDetail('${r.__backendId}')">
                <div class="h-56 bg-gray-200 relative overflow-hidden">
                     ${r.coverImage 
                        ? `<div class="w-full h-full bg-cover bg-center transition-transform duration-500 group-hover:scale-110" style="background-image:url('${r.coverImage}')"></div>` 
                        : `<div class="flex items-center justify-center h-full text-4xl bg-orange-100 text-orange-300">üçú</div>`
                     }
                     <div class="absolute top-3 left-3 bg-white/90 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-bold text-orange-600 shadow-sm">
                        ${r.category}
                     </div>
                </div>
                <div class="p-5">
                    <h3 class="font-bold text-xl text-gray-800 mb-1 leading-tight">${r.name}</h3>
                    <div class="text-sm text-gray-500 mb-3 flex items-center gap-1">
                        <span class="text-red-500">üìç</span> ${r.zone}
                    </div>
                    <p class="text-gray-500 text-sm line-clamp-2 mb-4 h-10">${r.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°'}</p>
                    <div class="flex justify-between items-center text-xs text-gray-400 border-t pt-3">
                        <span class="flex items-center gap-1">üïí ${r.openTime}-${r.closeTime}</span>
                        <span class="text-orange-500 font-bold group-hover:underline">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‚Üí</span>
                    </div>
                </div>
            </div>
        `).join('');
    }

    // --- 7. ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (Detail & Gallery) ---
    function viewDetail(id) {
        const r = restaurants.find(i => i.__backendId === id);
        if(!r) return;
        
        const galleryHtml = (r.gallery && r.gallery.length > 0) 
            ? `<div class="mt-8">
                 <h3 class="text-xl font-bold mb-4 flex items-center gap-2">üì∏ ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° <span class="text-sm font-normal text-gray-500">(${r.gallery.length} ‡∏£‡∏π‡∏õ)</span></h3>
                 <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    ${r.gallery.map(img => `
                        <div class="aspect-square rounded-xl overflow-hidden shadow-sm cursor-zoom-in group" onclick="window.open('${img}')">
                            <img src="${img}" class="w-full h-full object-cover transition duration-300 group-hover:scale-110">
                        </div>
                    `).join('')}
                 </div>
               </div>`
            : '';

        document.getElementById('restaurantDetailContent').innerHTML = `
            <div class="h-[40vh] md:h-[50vh] w-full bg-gray-200 relative group overflow-hidden">
                 ${r.coverImage 
                    ? `<div class="w-full h-full bg-cover bg-center" style="background-image:url('${r.coverImage}')"></div>` 
                    : `<div class="flex items-center justify-center h-full text-8xl bg-orange-100 text-orange-300">üçú</div>`
                 }
                 <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"></div>
                 <div class="absolute bottom-0 left-0 right-0 p-6 md:p-10 text-white">
                    <span class="bg-orange-500 text-white px-3 py-1 rounded-full text-sm font-bold mb-2 inline-block">${r.category}</span>
                    <h1 class="text-3xl md:text-5xl font-bold mb-2 shadow-sm">${r.name}</h1>
                    <p class="opacity-90 text-lg flex items-center gap-2">üìç ‡πÄ‡∏Ç‡∏ï${r.zone} <span class="text-gray-400">|</span> üïí ${r.openTime} - ${r.closeTime}</p>
                 </div>
            </div>
            <div class="p-6 md:p-10">
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="md:col-span-2">
                        <h3 class="font-bold text-gray-800 mb-3 text-2xl">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡πâ‡∏≤‡∏ô</h3>
                        <p class="text-gray-600 leading-relaxed text-lg">${r.description || '-'}</p>
                        ${galleryHtml}
                    </div>
                    <div class="md:col-span-1">
                        <div class="bg-orange-50 p-6 rounded-2xl border border-orange-100 sticky top-24">
                            <h4 class="font-bold text-gray-800 mb-4 text-lg">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h4>
                            <ul class="space-y-3 text-gray-600">
                                <li class="flex items-start gap-3"><span class="text-xl">üè†</span> <span>${r.address || '-'}</span></li>
                                <li class="flex items-center gap-3"><span class="text-xl">üìû</span> <a href="tel:${r.phone}" class="text-orange-600 hover:underline font-bold">${r.phone || '-'}</a></li>
                            </ul>
                            <button onclick="window.open('https://maps.google.com/?q=${encodeURIComponent(r.name + ' ' + r.zone)}')" class="w-full mt-6 py-3 bg-blue-500 text-white rounded-xl font-bold shadow hover:bg-blue-600 transition flex items-center justify-center gap-2">
                                üó∫Ô∏è ‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà Google Maps
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        showPage('detail');
    }

    // --- 8. ‡∏£‡∏∞‡∏ö‡∏ö Admin ---
    function handleLogin() {
        const u = document.getElementById('loginUsername').value;
        const p = document.getElementById('loginPassword').value;
        const user = users.find(x => x.username === u && x.password === p);
        if(user) { 
            currentUser = user; 
            document.getElementById('adminName').textContent = u; 
            showPage('admin'); 
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
        } else {
            alert('‚ùå ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        }
    }
    
    function handleLogout() { 
        if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?')) {
            currentUser = null; 
            showPage('home'); 
        }
    }

    function renderAdmin() {
        const list = document.getElementById('adminRestaurantList');
        if(restaurants.length === 0) {
            list.innerHTML = '<div class="text-center text-gray-400 py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</div>';
            return;
        }
        
        list.innerHTML = restaurants.map(r => `
            <div class="flex flex-col md:flex-row justify-between items-center p-4 bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition gap-4">
                <div class="flex items-center gap-4 w-full md:w-auto">
                    <div class="w-16 h-16 rounded-lg bg-gray-200 overflow-hidden flex-shrink-0">
                        ${r.coverImage ? `<img src="${r.coverImage}" class="w-full h-full object-cover">` : `<div class="flex items-center justify-center h-full text-xl">üçú</div>`}
                    </div>
                    <div>
                        <div class="font-bold text-lg text-gray-800">${r.name}</div>
                        <div class="text-sm text-gray-500 flex items-center gap-2">
                            <span>${r.category}</span>
                            <span class="w-1 h-1 bg-gray-300 rounded-full"></span>
                            <span>üì∑ ${r.gallery?.length||0} ‡∏£‡∏π‡∏õ</span>
                        </div>
                    </div>
                </div>
                <div class="flex gap-2 w-full md:w-auto">
                    <button onclick='showRestaurantForm(${JSON.stringify(r).replace(/'/g, "\\'")})' class="flex-1 md:flex-none px-4 py-2 bg-blue-50 text-blue-600 rounded-lg font-bold hover:bg-blue-100 transition">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                    <button onclick="deleteItem('${r.__backendId}')" class="flex-1 md:flex-none px-4 py-2 bg-red-50 text-red-600 rounded-lg font-bold hover:bg-red-100 transition">üóëÔ∏è ‡∏•‡∏ö</button>
                </div>
            </div>
        `).join('');
    }

    async function deleteItem(id) { 
        if(confirm('‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ? (‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)')) {
            await window.dataSdk.delete({__backendId:id, type:'restaurant'}); 
        }
    }

    // --- 9. ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (Image Processing) ---
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡πà‡∏≠‡∏£‡∏π‡∏õ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ö‡∏ô LocalStorage)
    function resizeImage(file, maxWidth = 500, quality = 0.6) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (event) => {
                const img = new Image();
                img.src = event.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;

                    if (width > maxWidth) {
                        height = Math.round((height * maxWidth) / width);
                        width = maxWidth;
                    }

                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Base64
                    resolve(canvas.toDataURL('image/jpeg', quality));
                };
                img.onerror = (err) => reject(err);
            };
            reader.onerror = (err) => reject(err);
        });
    }

    // --- 10. ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ---
    function showRestaurantForm(r=null) {
        editingItem = r;
        document.getElementById('restaurantFormTitle').textContent = r ? '‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô' : '‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà';
        
        // Map data to inputs
        const fields = ['Name','Category','Zone','Description','Address','Phone','OpenTime','CloseTime'];
        fields.forEach(k => {
            document.getElementById('form'+k).value = r ? (r[k.toLowerCase().replace('name','name').replace('time','Time')] || '') : '';
        });
        
        coverImg = r ? (r.coverImage || '') : '';
        galleryImgs = r ? (r.gallery ? [...r.gallery] : []) : [];
        
        updatePreviews();
        
        document.getElementById('restaurantModal').classList.remove('hidden');
        document.getElementById('restaurantModal').classList.add('flex');
    }
    
    function closeRestaurantForm() { 
        document.getElementById('restaurantModal').classList.add('hidden'); 
        document.getElementById('restaurantModal').classList.remove('flex'); 
    }

    // --- Handle Cover Image (Crop) ---
    function handleCoverUpload(e) {
        const file = e.target.files[0];
        if(file) {
            const reader = new FileReader();
            reader.onload = (evt) => {
                document.getElementById('cropImage').src = evt.target.result;
                document.getElementById('cropModal').classList.remove('hidden');
                document.getElementById('cropModal').classList.add('flex');
                
                if(cropper) cropper.destroy();
                const image = document.getElementById('cropImage');
                cropper = new Cropper(image, { aspectRatio: 16/9, viewMode: 1, autoCropArea: 1 });
            };
            reader.readAsDataURL(file);
        }
        e.target.value = '';
    }
    
    function confirmCrop() {
        if(!cropper) return;
        // ‡∏¢‡πà‡∏≠‡∏£‡∏π‡∏õ‡∏õ‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 600px ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏ó‡∏µ‡πà
        const canvas = cropper.getCroppedCanvas({ maxWidth: 600, fillColor: '#fff' });
        coverImg = canvas.toDataURL('image/jpeg', 0.7);
        updatePreviews();
        document.getElementById('cropModal').classList.add('hidden');
        document.getElementById('cropModal').classList.remove('flex');
    }

    // --- Handle Gallery Images (Multi-upload & Resize) ---
    async function handleGalleryUpload(e) {
        const files = Array.from(e.target.files);
        if(files.length === 0) return;
        
        const btn = document.querySelector('#galleryImageInput').previousElementSibling;
        const originalText = btn.innerText;
        btn.innerText = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡πà‡∏≠‡∏£‡∏π‡∏õ...';
        btn.disabled = true;

        try {
            for (let file of files) {
                // ‡∏¢‡πà‡∏≠‡∏£‡∏π‡∏õ‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 450px ‡∏û‡∏≠
                const resized = await resizeImage(file, 450, 0.6);
                galleryImgs.push(resized);
            }
            updatePreviews();
        } catch(err) {
            console.error(err);
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ');
        } finally {
            btn.innerText = originalText;
            btn.disabled = false;
        }
        e.target.value = '';
    }

    function removeCoverImage() { coverImg = ''; updatePreviews(); }
    
    function removeGalleryImage(idx) {
        galleryImgs.splice(idx, 1);
        updatePreviews();
    }

    function updatePreviews() {
        // Cover
        const cp = document.getElementById('coverPreview');
        const cpi = document.getElementById('coverPreviewImg');
        if(coverImg) { 
            cp.classList.remove('hidden'); 
            cpi.src = coverImg; 
        } else { 
            cp.classList.add('hidden'); 
        }

        // Gallery
        const gp = document.getElementById('galleryPreviewGrid');
        gp.innerHTML = galleryImgs.map((img, i) => `
            <div class="relative aspect-square bg-gray-100 rounded overflow-hidden group border">
                <img src="${img}" class="w-full h-full object-cover">
                <button onclick="removeGalleryImage(${i})" class="absolute top-1 right-1 bg-red-500 text-white w-5 h-5 rounded-full flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition shadow">√ó</button>
            </div>
        `).join('');
    }

    // --- Save Data ---
    async function saveRestaurant() {
        const name = document.getElementById('formName').value.trim();
        if(!name) return alert('‚ùó ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô');
        
        const saveBtn = document.getElementById('saveRestaurantBtn');
        saveBtn.innerText = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
        saveBtn.disabled = true;

        const data = {
            type: 'restaurant',
            name,
            category: document.getElementById('formCategory').value,
            zone: document.getElementById('formZone').value,
            description: document.getElementById('formDescription').value,
            address: document.getElementById('formAddress').value,
            phone: document.getElementById('formPhone').value,
            openTime: document.getElementById('formOpenTime').value,
            closeTime: document.getElementById('formCloseTime').value,
            coverImage: coverImg,
            gallery: galleryImgs
        };

        // Delay ‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ UI ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
        setTimeout(async () => {
            if(editingItem) {
                await window.dataSdk.update({...editingItem, ...data});
            } else {
                await window.dataSdk.create(data);
            }
            saveBtn.innerText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            saveBtn.disabled = false;
            closeRestaurantForm();
            // alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        }, 100);
    }

    // Start App
    init();
  </script>
 </body>
</html>
